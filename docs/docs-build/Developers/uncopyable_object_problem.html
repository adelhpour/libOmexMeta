

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>The “Uncopyable object” problem &mdash; libomexmeta 0.0.1 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> libomexmeta
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../background.html">Background to Semantic Annotations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Examples/examples.html">LibOmexMeta Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../APIReference/api_reference.html">API Reference</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">libomexmeta</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>The “Uncopyable object” problem</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/Developers/uncopyable_object_problem.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="the-uncopyable-object-problem">
<h1>The “Uncopyable object” problem<a class="headerlink" href="#the-uncopyable-object-problem" title="Permalink to this headline">¶</a></h1>
<p>Here I detail why most objects are not copyable and what it would take to
get them copyable.</p>
<p>The crux of the problem is that <cite>librdf_uri*</cite> is not a copyable entity. This is by design in redland.
When you try to create a new <cite>librdf_uri</cite> redland will check the existing uri’s and if it finds a match,
it’ll return it, instead of making a new one. Note that even the <cite>librdf_new_uri_from_uri</cite> function
which is stated to be a copy constructor in the redland docs, only takes shallow copies. Practically,
this means that redland returns the <em>same</em> <cite>librdf_uri</cite> pointer but increments the
<cite>librdf_uri</cite> count attribute.</p>
<p>This has significant implications for pretty much all omexmeta objects, particularly in the annotation creation
API. In order to make copy constructors, the underlying reference counter system must be manipulated correctly.
On the surface this sounds easy, you just add 1 whenever you copy and subtract 1 whenever you delete, unless
the count is at 1 in which case you call <cite>free</cite>. The problem is that the redland libraries are complicated
and the documentation is terrible (and outdated). So this strategy will theoretically work, if you get it right,
but its very easy to get wrong without intimate knowledge of the redland libraries. Really, the whole reference
counter system should be replaced with a <cite>std::shared_ptr</cite> to handle this automatically, but this is not a small
task.</p>
<p>The solution, which isn’t ideal but a compromise, is to enforce the objects in the redland c++ wrapper
to be unique by disabling the copy constructor and copy assignment constructor. Note, this is the same strategy employed
by <cite>std::unique_ptr</cite>. Practically, this means that objects must be moved using <cite>std::move</cite> instead of copied. This
is quite a restriction on what is possible and sometimes the most straight forward design needs to be modified
to account for this. In fact, its a bit like programming with both arms tied behind your back, and you certainly feel
like mashing your face against the keyboard sometimes.</p>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Ciaran Welsh

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>